<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>React Ticker for Vidra</title>
    <!-- React & ReactDOM (UMD via CDN for simple example) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: transparent;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        #root {
            width: 100%;
            height: 100%;
        }
        .ticker-container {
            background: rgba(48, 54, 61, 0.8);
            border: 1px solid rgba(88, 166, 255, 0.3);
            border-radius: 12px;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            font-size: 24px;
            font-weight: 500;
        }
        .price {
            color: #58a6ff;
            font-weight: bold;
            font-size: 32px;
            margin-left: 12px;
            min-width: 140px;
            text-align: right;
            font-variant-numeric: tabular-nums;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        // Provide the @sansavision/vidra-web-capture hook standalone logic for the example
        function useVidraScene() {
            const [frame, setFrame] = React.useState({
                time: 0,
                frame: 0,
                fps: 30,
                playState: 'playing',
                vars: {}
            });

            React.useEffect(() => {
                // Determine if we are running in the Vidra Headless renderer
                if (window.__vidra) {
                    window.__vidra_advance_frame = (params) => {
                        setFrame({
                            time: params.time,
                            frame: params.frame_index,
                            fps: params.fps,
                            playState: params.state,
                            vars: params.vars || {}
                        });
                        // Tell headless Chromium we are done rendering
                        if (window.onVidraRender) window.onVidraRender();
                    };
                } else {
                    // Fallback browser loop for development testing
                    let start = Date.now();
                    let handle;
                    const fallbackLoop = () => {
                        setFrame(prev => ({
                            ...prev,
                            time: (Date.now() - start) / 1000,
                            frame: Math.floor((Date.now() - start) / 1000 * 30),
                        }));
                        handle = requestAnimationFrame(fallbackLoop);
                    };
                    handle = requestAnimationFrame(fallbackLoop);
                    return () => cancelAnimationFrame(handle);
                }
            }, []);

            return frame;
        }

        // Ticker Component
        function LiveTicker() {
            // Hook natively synced to Vidra's timeline
            const { time, vars } = useVidraScene();

            // Calculate animated price increment
            const startPrice = 9.99;
            const targetPrice = 29.99;
            
            // Reaches target after 3 seconds
            const progress = Math.min(1, Math.max(0, time / 3.0));
            // easeOutExpo
            const ease = progress === 1 ? 1 : 1 - Math.pow(2, -10 * progress);
            
            const currentPrice = startPrice + (targetPrice - startPrice) * ease;

            return React.createElement('div', { className: 'ticker-container loaded' },
                React.createElement('span', null, 'Limited Time Offer:'),
                React.createElement('span', { className: 'price' }, '$' + currentPrice.toFixed(2))
            );
        }

        // Render React App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(LiveTicker));
    </script>
</body>
</html>
